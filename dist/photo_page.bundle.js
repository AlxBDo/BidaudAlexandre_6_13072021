(()=>{"use strict";const e={getListenFctName:function(){return[]},addListenner:function(){let e=this.getListenFctName();e.length>0&&e.forEach((e=>{this[e]()}))},listen:function(t){t&&"object"==typeof t&&t.forEach((t=>{e.addListenner.call(t)}))}};class t{profilImgPath(){return"img/photos/Profils/"}constructor(e,n){if(this.constructor===t)throw"This object can't be instancied !";this.jdo=e,this.media=n}getBook(){return this.media}getComeFrom(){return this.jdo.city+", "+this.jdo.country}getId(){return this.jdo.id}getLiTags(e){"object"==typeof e&&this.getTags().forEach((t=>{let n=document.createElement("li");n.classList.add("inline-block","first-color-text","tags");let i=document.createElement("span");i.textContent=t,i.ariaLabel="Tag",n.append(i),e.append(n)}))}getName(){return this.jdo.name}getPortrait(){return this.jdo.portrait}getPrice(){return this.jdo.price+"€ / jour"}getTagline(){return this.jdo.tagline}getTags(){return this.jdo.tags}setProfilImgSrc(e){e.setAttribute("src",this.profilImgPath()+this.getPortrait()),e.setAttribute("atl",this.getName()+"'s photo profil"),e.setAttribute("role","presentation")}}class n extends t{static htmlContainer(){return document.getElementById("photographers-list")}profilContainer(){return document.getElementById("photographers-list")}static ajustHeightImg(){let e=document.querySelectorAll(".profil img"),t=window.innerWidth,n=t>1023?.9*t*.15:t/1.79;e.forEach((e=>{e.style.height=parseInt(n)+"px"}))}getProfilPageLink(){return"photographer_page.html?id="+this.getId()}static initHTMLContainer(){this.htmlContainer().innerHTML=""}show(){let e=document.createElement("a");e.classList.add("profil","flex"),e.setAttribute("href",this.getProfilPageLink()),e.ariaLabel=this.getName()+"'s profil link";let t=document.createElement("img");this.setProfilImgSrc(t),e.append(t);let n=document.createElement("h2");n.classList.add("name-photographer"),n.ariaLabel="Name",n.textContent=this.getName(),e.append(n);let i=document.createElement("p");i.textContent=this.getComeFrom(),i.ariaLabel="Location",e.append(i);let o=document.createElement("p");o.textContent=this.getTagline(),e.append(o);let r=document.createElement("p");r.textContent=this.getPrice(),r.ariaLabel="hour price",e.append(r);let s=document.createElement("ul");s.classList.add("flex"),this.getLiTags(s),e.append(s),this.profilContainer().append(e)}}const i="Fisheye"!==document.title?document.getElementById("current-element-type"):"",o="Fisheye"!==document.title?document.getElementById("gallery"):"",r=document.querySelectorAll("a.media"),s="Fisheye"!==document.title?document.getElementById("like-total"):"",a="Fisheye"!==document.title?document.getElementById("contact-form-modal").classList:"",l="Fisheye"!==document.title?document.getElementById("order-by-container").classList:"",c="Fisheye"!==document.title?document.getElementById("photo-sum"):"",d="Fisheye"!==document.title?document.getElementById("video-sum"):"";class u extends t{media_path(){return"img/photos/"}addMediaInGallery(e,t,n,i,o){let r=document.getElementById(t+"-container-"+n);return r.classList.replace("hidden","photo-container"),r.setAttribute("aria-label",e.title+", closeup view"),r.append(this.getMediaPattern(e,t,n,i,o)),r.append(this.getMediaTitlePattern(e,t,n)),r.append(this.getMediaLikePattern(e,t,n)),r.append(this.getPPattern("date",t,n,e.date)),r}addPortraitImg(){let e=document.createElement("img");this.setProfilImgSrc(e),document.getElementById("photographer-informations").append(e)}getMediaLikePattern(e,t,n){let i=document.createElement("a");return i.setAttribute("id",t+"-like-"+n),i.setAttribute("href",""),i.classList.add("like"),i.setAttribute("role","text"),i.setAttribute("aria-label","likes"),i.textContent=e.likes,i}getMediaPattern(e,t,n,i,o){let r="photo"===t?document.createElement("img"):document.createElement("video");return r.setAttribute("id",t+"-"+n),r.setAttribute("src",this.media_path()+i+"/"+o),r.setAttribute("alt",e["alt-text"]),r.setAttribute("aria-label",e.title),r}getMediaTitlePattern(e,t,n){let i=document.createElement("h2");return i.setAttribute("id",t+"-title-"+n),i.textContent=e["alt-text"],i}getPPattern(e,t,n,i){let o=document.createElement("p");return o.setAttribute("id",t+"-"+e+"-"+n),o.classList.add("like"===e?"like":"hidden"),o.textContent=i,o}show(){["Name","ComeFrom","Tagline","Tags","Portrait","Price","name-title-contact","Book"].forEach((e=>{switch(e){case"Book":this.showBook(this.getBook(),this.getName());break;case"name-title-contact":document.getElementById(e).textContent=this.getName();break;case"Portrait":this.addPortraitImg();break;case"Tags":this.getLiTags(document.getElementById("Tags"));break;default:document.getElementById(e).textContent=this["get"+e]()}}))}showBook(e,t){if(Array.isArray(e)){let n=0,i="",o=0,r=0,a=0;for(let s of e)if("object"==typeof s){let e=s.image?s.image:s.video,l=e.split(".");"jpg"===l[1]?(n=o,i="photo",o++):"mp4"===l[1]&&(n=r,i="video",r++),this.addMediaInGallery(s,i,n,t,e),a+=s.likes}s.textContent=a,c.value=o,d.value=r}}}class m{static jsonDataFile(){return"https://alxbdo.github.io/BidaudAlexandre_6_13072021/data/fishEyeData.json"}static getPhotographerMedia(e,t){if(Array.isArray(e)){let n=[];for(let i of e)parseInt(i.photographerId)===parseInt(t)&&n.push(i);return n}}static search(e=!1,t=!1){fetch(this.jsonDataFile()).then((function(e){if(e.ok)return e.json()})).then((function(i){if(Array.isArray(i.photographers)){for(let o of i.photographers){let r=m.getPhotographerMedia(i.media,o.id);!e||"tags"===e&&o[e].includes(t)?new n(o,r).show():"id"===e&&parseInt(o.id)===parseInt(t)&&new u(o,r).show()}"id"!==e&&n.ajustHeightImg()}})).catch((function(e){console.log(e)}))}}const h={elements_date:[],elements_like:[],elements_title:[],order_by_select:document.getElementById("order-by"),addElementsArray:function(e,t){let n=document.getElementById(t[0]+"-"+e+"-"+t[2]);n&&this["elements_"+e].push({id:t[0]+"-"+t[1]+"-"+t[2],value:"date"!==e?n.textContent:this.getDateNumberFormat(n.textContent)})},addLikeOnClick:function(){setTimeout((function(){document.querySelectorAll(".like").forEach((e=>{e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),e.classList.contains("liked")||h.addLikeWork(e)}))}))}),100)},addLikeWork:function(e){"object"==typeof e&&(e.textContent=parseInt(e.textContent)+1,s.textContent=parseInt(s.textContent)+1,e.classList.add("liked"))},createElementArray:function(e){r.forEach((t=>{this.addElementsArray(e,this.getDomElementIdArray(t))}))},displayBookSorted:function(e){let t=1;for(let n of this.getElementsArray(e))if(n.id&&""!==n.id){let e=document.getElementById(n.id),i=75*t+100;e.style.order=t,e.classList.add("invisible"),setTimeout((function(){e.classList.remove("invisible")}),i),t++}},getDateNumberFormat:function(e){let t=e.split("-");return t[2]+t[1]+t[0]},getDomElementIdArray:function(e){return e.getAttribute("id").split("-")},getElementsArray:function(e){return 0===this["elements_"+e].length&&(this.createElementArray(e),this.sortBook(e)),this["elements_"+e]},getListenFctName:function(){return["addLikeOnClick","orderByClick","selectOptionsClick"]},orderByClick:function(){this.order_by_select.addEventListener("click",(function(e){e.preventDefault(),this.classList.contains("open")?(this.classList.remove("open"),this.setAttribute("aria-expanded",!1)):(this.classList.add("open"),this.setAttribute("aria-expanded",!0))}))},selectOptionsClick:function(){document.querySelectorAll("#order-by a").forEach((e=>{e.addEventListener("click",(function(t){t.preventDefault(),l.remove("date-slct","title-slct");let n=e.getAttribute("id");document.getElementById("order-by-select").selectedIndex="date"===n?1:"like"===n?0:2,l.add(n+"-slct"),h.displayBookSorted(n)}))}))},sortBook:function(e){this["elements_"+e].sort(this.sortBookElement)},sortBookElement:function(e,t){let n=e.value,i=t.value;return isNaN(n)||(n=parseInt(n),i=parseInt(i)),n>i?1:n<i?-1:0}},g={close_modal_btn:document.getElementById("close-modal-form"),form_dom_obj:document.getElementById("contact"),inputs_value:new Map,open_form_link:document.getElementById("contact-form-link"),check:function(){for(let e of this.form_dom_obj.elements){if(!this.checkInput(e))return!1;this.inputs_value.set(e.id,e.value)}return!0},checkInput:function(e){if(""!==e.id){let t=e.id.includes("name")?"Name":e.id.charAt(0).toUpperCase()+e.id.substring(1);if(!this["check"+t.charAt(0).toUpperCase()+t.substring(1)](e.value))return this.errorInput(e);this.validInput(e)}return!0},checkEmail:function(e){return!!/([\w-.]+@[\w.]+\.{1}[\w]+)/.test(e)},checkMessage:function(e){return e.length>14&&e.length<301},checkName:function(e){return!(e.length<2||/[@:./\\_{}[\]()|%*$£?!&~#`µ0-9]/.test(e))},clear:function(){for(let e of this.form_dom_obj.elements)if(""!==e.id){e.value="";let t=document.getElementById(e.id+"-info").classList;t.contains("err")&&t.remove("err"),t.contains("valid")&&t.remove("valid")}setTimeout((function(){a.remove("submitted"),a.replace("opened","closed")}),3e3)},close:function(){a.replace("opened","closed"),document.getElementById("fishEye-HomePage").focus()},closeClick:function(){this.close_modal_btn.addEventListener("click",(e=>{e.preventDefault(),this.close()}))},errorInput:function(e){let t=document.getElementById(e.id+"-info").classList;return t.contains("valid")&&t.remove("valid"),t.add("err"),e.focus(),!1},getListenFctName:function(){return["submit","closeClick","open","onChangeInput"]},onChangeInput:function(){for(let e of this.form_dom_obj.elements)e.addEventListener("change",(function(){g.checkInput(e)}))},open:function(){this.open_form_link.addEventListener("click",(e=>{e.preventDefault(),a.replace("closed","opened"),this.close_modal_btn.focus()}))},send:function(){if(this.check()){document.getElementById("recipient-name").textContent=document.getElementById("name-title-contact").textContent,a.add("submitted"),console.log("Valeurs des inputs : ");for(let e of this.inputs_value)console.log(e);this.clear(),document.getElementById("fishEye-HomePage").focus()}},submit:function(){this.form_dom_obj.addEventListener("submit",(e=>{e.preventDefault(),this.send()}))},validInput:function(e){let t=document.getElementById(e.id+"-info").classList;t.contains("err")&&t.remove("err"),t.add("valid")}},p={close_lightbox_btn:document.getElementById("close-lightbox"),galleryClassList:o.classList,lightboxPosition:document.getElementById("lightbox-position"),getCurrentPosition:function(){return parseInt(this.lightboxPosition.value)},getGalleryMode:function(){return this.galleryClassList.contains("gallery")?"gallery":"lightbox"},getListenFctName:function(){return["closeClick","openClick","moveClick"]},getNewIdHTML:function(e){let t=i.value;return(e>=("photo"===t?c.value:d.value)||e<0)&&(e=e<0&&"video"===t?c.value-1:0,"photo"===t&&d.value>0?t="video":"video"===t&&c.value>0&&(t="photo")),[t,e]},setCurrentPosition:function(e){this.lightboxPosition.value=e},setCurrentType:function(e){i.value=e},activeElement:function(e){this.addActivClass(e),this.setCurrentPosition(h.getDomElementIdArray(e)[2])},addActivClass:function(e){e.classList.add("activ")},changeBookView:function(){let e=this.getGalleryMode(),t="gallery"===e?"lightbox":"gallery";"lightbox"!==t?(o.setAttribute("role","none"),o.setAttribute("aria-label",""),this.clearActivClass()):(o.setAttribute("role","dialog"),o.setAttribute("aria-label","image closeup view")),this.changeGalleryClass(t,e)},changeGalleryClass:function(e,t){this.galleryClassList.remove(t),this.galleryClassList.add(e)},clearActivClass:function(){document.querySelector(".activ").classList.remove("activ")},closeClick:function(){this.close_lightbox_btn.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),p.changeBookView()}))},openClick:function(){r.forEach((e=>{e.addEventListener("click",(function(t){t.preventDefault(),"gallery"===p.getGalleryMode()&&(p.changeBookView(),p.activeElement(e))}))}))},move:function(e="next"){this.clearActivClass();let t="next"===e?this.getCurrentPosition()+1:this.getCurrentPosition()-1,n=this.getNewIdHTML(t);this.setCurrentType(n[0]),this.activeElement(document.getElementById(n[0]+"-container-"+n[1]))},moveClick:function(){document.querySelectorAll(".move").forEach((e=>{e.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),p.move(e.getAttribute("id"))}))}))}};let f={keys_searched:["ArrowLeft","ArrowRight","Escape"],getListenFctName:function(){return["listenKeyboard"]},listenKeyboard:function(){document.addEventListener("keydown",(e=>{this.keys_searched.forEach((t=>{e.key===t&&this[t+"Action"]()}))}),!1)},ArrowLeftAction:function(){p.move("previous")},ArrowRightAction:function(){p.move("next")},EscapeAction:function(){"lightbox"===p.getGalleryMode()?p.changeBookView():g.close()}},y=window.location.href;if(y.split("?")[1]){let t=new URLSearchParams(y.split("?")[1]);t.has("id")&&(m.search("id",t.get("id")),e.listen([h,g,f,p]))}})();